# Account Service - CURL Commands

Base URL: `http://localhost:8080/api/accounts`

## 1. Create Account

Creates a new bank account for a user (requires TELLER role).

```bash
curl -X POST http://localhost:8080/api/accounts/create \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer TELLER_JWT_TOKEN" \
  -d '{
    "userId": 1,
    "citizenId": "3101234567890",
    "accountType": "SAVINGS",
    "initialBalance": 10000.00
  }'
```

**Response:**
```json
{
  "id": "1234567",
  "userId": 1,
  "accountType": "SAVINGS",
  "balance": 10000.0,
  "status": "ACTIVE",
  "createdAt": "2025-11-22T10:30:00"
}
```

## 2. Get Account by ID

Retrieves account details by account ID (account number).

```bash
curl -X GET http://localhost:8080/api/accounts/1234567 \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

**Response:**
```json
{
  "id": "1234567",
  "userId": 1,
  "accountType": "SAVINGS",
  "balance": 10000.0,
  "status": "ACTIVE",
  "createdAt": "2025-11-22T10:30:00"
}
```

## 3. Get Accounts by User ID

Retrieves all accounts for a specific user.

```bash
curl -X GET http://localhost:8080/api/accounts/user/1 \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

**Response:**
```json
[
  {
    "id": "1234567",
    "userId": 1,
    "accountType": "SAVINGS",
    "balance": 10000.0,
    "status": "ACTIVE",
    "createdAt": "2025-11-22T10:30:00"
  }
]
```

## 4. Update Account Balance

Updates account balance (used internally by orchestrator services).

```bash
curl -X PUT http://localhost:8080/api/accounts/1234567/balance \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "amount": 5000.00
  }'
```

**Note:** 
- Positive amount = credit (increase balance)
- Negative amount = debit (decrease balance)

**Response:**
```json
{
  "id": "1234567",
  "userId": 1,
  "accountType": "SAVINGS",
  "balance": 15000.0,
  "status": "ACTIVE",
  "createdAt": "2025-11-22T10:30:00"
}
```

## 5. Health Check

Check if the account service is running.

```bash
curl -X GET http://localhost:8080/api/accounts/health
```

**Response:**
```
Account Service is running
```

---

## Complete Account Creation Flow

### Prerequisites
1. Register users (Alice, Bob, Teller) via Register Service
2. Login as Teller to get JWT token

### Step 1: Login as Teller
```bash
TELLER_LOGIN=$(curl -s -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "teller_user",
    "password": "tellerPass123"
  }')

TELLER_TOKEN=$(echo "$TELLER_LOGIN" | jq -r '.token')
echo "Teller Token: $TELLER_TOKEN"
```

### Step 2: Create Account for Alice with Initial Balance
```bash
ALICE_ACCOUNT=$(curl -s -X POST http://localhost:8080/api/accounts/create \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TELLER_TOKEN" \
  -d '{
    "userId": 1,
    "citizenId": "3101234567890",
    "accountType": "SAVINGS",
    "initialBalance": 10000.00
  }')

ALICE_ACCOUNT_ID=$(echo "$ALICE_ACCOUNT" | jq -r '.id')
echo "Alice Account ID: $ALICE_ACCOUNT_ID"
echo "$ALICE_ACCOUNT" | jq '.'
```

### Step 3: Create Account for Bob with Zero Balance
```bash
BOB_ACCOUNT=$(curl -s -X POST http://localhost:8080/api/accounts/create \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TELLER_TOKEN" \
  -d '{
    "userId": 2,
    "citizenId": "3119876543210",
    "accountType": "SAVINGS",
    "initialBalance": 0
  }')

BOB_ACCOUNT_ID=$(echo "$BOB_ACCOUNT" | jq -r '.id')
echo "Bob Account ID: $BOB_ACCOUNT_ID"
echo "$BOB_ACCOUNT" | jq '.'
```

### Step 4: Login as Alice
```bash
ALICE_LOGIN=$(curl -s -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "alice_user",
    "password": "alicePass123"
  }')

ALICE_TOKEN=$(echo "$ALICE_LOGIN" | jq -r '.token')
```

### Step 5: Alice Views Her Accounts
```bash
curl -X GET http://localhost:8080/api/accounts/user/1 \
  -H "Authorization: Bearer $ALICE_TOKEN" | jq '.'
```

### Step 6: Alice Views Specific Account
```bash
curl -X GET http://localhost:8080/api/accounts/$ALICE_ACCOUNT_ID \
  -H "Authorization: Bearer $ALICE_TOKEN" | jq '.'
```

---

## Authorization Notes

- **Create Account**: Requires TELLER role
- **Get Account by ID**: User can only view their own accounts (or TELLER can view any account)
- **Get Accounts by User ID**: User can only view their own accounts
- **Update Balance**: Internal use only (called by orchestrator services like Deposit/Transfer)

Account numbers are 7-digit numbers automatically generated by the system.
