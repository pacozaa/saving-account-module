sequenceDiagram
    participant Customer as CUSTOMER/PERSON (Client)
    participant Teller as TELLER (Client)
    participant Gateway as API Gateway
    participant Auth as Auth Service
    participant Account as Account Service
    participant AccountsDB as Accounts DB
    participant Deposit as Deposit Service
    participant Transaction as Transaction Service
    participant TransDB as Transactions DB

    Note over Customer,TransDB: Feature 2: Creating a New Account

    Customer->>Teller: Request new account<br/>(citizenId, thaiName, englishName)
    
    Note over Teller: TELLER logs in first
    Teller->>Gateway: POST /auth/login<br/>{username, password}
    Gateway->>Auth: Validate credentials
    Auth-->>Gateway: JWT token (role=TELLER)
    Gateway-->>Teller: {token, expiresIn}
    
    Note over Teller: Option 1: Create account without deposit
    
    Teller->>Gateway: POST /accounts/create<br/>Authorization: Bearer {token}<br/>{citizenId, thaiName,<br/>englishName, accountType}
    Gateway->>Gateway: Validate JWT & role=TELLER
    Gateway->>Account: Forward create account request
    
    Account->>Account: Validate citizen info
    Account->>Account: Generate 7-digit account number
    Account->>AccountsDB: INSERT Account<br/>(citizenId, accountNumber,<br/>balance=0, thaiName,<br/>englishName, accountType)
    AccountsDB-->>Account: Account created
    Account-->>Gateway: {accountId, accountNumber, balance=0}
    Gateway-->>Teller: 201 Created<br/>{accountNumber}
    
    Teller-->>Customer: Here is your account number:<br/>{accountNumber}
    
    Note over Teller: Option 2: Create account with deposit
    
    Teller->>Gateway: POST /accounts/create<br/>Authorization: Bearer {token}<br/>{citizenId, thaiName,<br/>englishName, accountType,<br/>initialDeposit}
    Gateway->>Gateway: Validate JWT & role=TELLER
    Gateway->>Account: Forward create account request
    
    Account->>Account: Validate citizen info
    Account->>Account: Validate initialDeposit >= 1 THB
    Account->>Account: Generate 7-digit account number
    Account->>AccountsDB: INSERT Account<br/>(citizenId, accountNumber,<br/>balance=initialDeposit,<br/>thaiName, englishName)
    AccountsDB-->>Account: Account created
    
    Note over Account,Transaction: Log initial deposit transaction
    
    Account->>Transaction: POST /transactions<br/>{accountId, type=DEPOSIT,<br/>amount, tellerId}
    Transaction->>TransDB: INSERT Transaction
    TransDB-->>Transaction: Transaction logged
    Transaction-->>Account: Transaction ID
    
    Account-->>Gateway: {accountId, accountNumber,<br/>balance=initialDeposit}
    Gateway-->>Teller: 201 Created<br/>{accountNumber, balance}
    
    Teller-->>Customer: Account created with<br/>account number: {accountNumber}<br/>Initial balance: {balance} THB
